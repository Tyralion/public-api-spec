

# Публичные API

Публичноые API делятся на 2 основных класса:

* API платформы - общесистемное API которое позволяет получить доступ к базовым данным платформы.
* API модулей - каждый модуль предоставляет своё собственное API которое реализует именно функции модуля. 

# Авторизация

Для авторизации приложений мы используем oAuth2 и концепцию сервисных аккаунтов. Это означает, что каждое приложение действует не от лица определённого пользователя, а от лица компании. При этом возможность совершать действия от лица определённого пользователя предусмотрена и может быть реализована на уровне API модуля (это зависит исключительно от модуля).

## Регистрация приложения

Для подключения приложения нужно пройти стандартную процедуру регистрации приложения, получения `client_id` и ключей.

* Зайти в интерфейс управления приложениями
* Добавить приложение - получить `client_id`
* Выбрать скоупы в которых может действовать приложение (скоупы платформы и модулей)
* Получить пару ключей для подписи и проверки подписи токенов.

После регистрации приложения нужно выполнить стандартную процедуру получения ключа:

* Сформировать JWT токен
* Запросить токен у сервера авторизации
* Использовать токен полученый на предыдущем шаге для API вызовов

Токен полученый для API вызовов имеет определённый срок действия, если срок действия подошёл к концу, то процедуру получения токена необходимо произвести снова.

## Скоупы приложения

Платформа и модули реализуют определённый набор скоупов в рамках которых приложения могут выполнять определённые действия. Возможность регистрировать много приложений, а также возможность разделять их на скоупы позволяет построить на стороне клиента максимально гибкую систему в плане безопасности.

* users - доступ к данным пользователей
  * users:read - чтение данных пользователей
  * user:write - запись данных пользователей
* auth:write - специальный скоуп для управления аутентификационными данными пользователей, читать их можно в скоупе `users:read`
* teams - доступ к организационной структуре компании
  * teams:read - чтение данных организационной структуры
  * teams:write - запись данных организационной структуры

# WebHook

Для обеспечения возможности обратной связи между сервисами TalentTech и внешними интеграциями. Предусмотрен механизм регистрации webhook'ов. Каждое приложение может зарегистрировать неограиченное количество хуков.

## Авторизация хука

При регистрации хука следует указать секретный токен на основании которого будет вычисляться подпись и передаваться в заголовке `Authorization`, что позволит принимающей стороне однозначно проверить подлинность вызова.

Подпись вычисляется следующим образом:

* раз
* два
* три

## Параметры хука

Базовые параметры хука включают в себя:

```{
{
  "company_id" : "ID компании",
  "user_id" : "Идентификатор пользователя если была операция в которой он был передан",
  "status" : "Значение статуса операции: [success, error, info]",
  "module" : "Имя модуля в котором произоло событие",
  "event" : "Имя события в рамках модуля",
  "description" : "Текстовое описание события",
  "created_at" : "Время возникновения события в модуле",
  "scheduled_at" : "Время первой отправки события из платформы",
  "retries" : "Количество попыток отправки, на первой отправке всегда 0",
}
```

При регистрации хука можно указать фильтр по полям `module` и `event` , и в результате получать события которые возникают только в определённом модуле(ях) с определёнными идентификаторами.

Все дополнительные ключи которые приходят в сообщении зависят от события и описываются отдельно.

# OpenAPI спецификации

* [foundation.yaml](foundation.yaml) - API платформы

